##引入mybatis支持
$!mybatisSupport

##设置保存名称与保存位置
$!callback.setFileName($tool.append($!{tableInfo.name}, "Mapper.xml"))
$!callback.setSavePath($tool.append($modulePath, "/src/main/resources/mapper"))

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="$!{tableInfo.savePackageName}.dao.$!{tableInfo.name}DAO">

    <resultMap type="$!{tableInfo.savePackageName}.model.entity.$!{tableInfo.name}" id="baseMap">
#foreach($column in $tableInfo.fullColumn)
        <result property="$!column.name" column="$!column.obj.name" jdbcType="$!column.ext.jdbcType"/>
#end
    </resultMap>
    
    <sql id="columns">
        #foreach($column in $tableInfo.fullColumn)`$!column.obj.name`#if($velocityHasNext), #end#end
        
    </sql>

    <sql id="columns_value">
        #foreach($column in $tableInfo.fullColumn)#{$!{column.name}}#if($velocityHasNext), #end#end
        
    </sql>

    <sql id="columns_item_value">
        #foreach($column in $tableInfo.fullColumn)#{item.$!{column.name}}#if($velocityHasNext), #end#end
        
    </sql>
    
    <sql id="where">
        <where>
            <if test="eqWrapper != null">
#foreach($column in $tableInfo.fullColumn)
                <if test="eqWrapper.$!column.obj.name != null">
                    and `$!column.obj.name` = #{eqWrapper.$!column.obj.name}
                </if>
#end
            </if>
            <if test="neqWrapper != null">
#foreach($column in $tableInfo.fullColumn)
                <if test="neqWrapper.$!column.obj.name != null">
                    and `$!column.obj.name` != #{neqWrapper.$!column.obj.name}
                </if>
#end
            </if>
            <if test="inWrapper != null">
#foreach($column in $tableInfo.fullColumn)
                <if test="inWrapper.$!column.obj.name != null and inWrapper.$!{column.obj.name}.size() > 0">
                    and `$!column.obj.name` in
                    <foreach collection="inWrapper.$!column.obj.name" item="$!column.obj.name" open="(" separator="," close=")">
                        #{$!column.obj.name}
                    </foreach>
                </if>
#end
            </if>
            <if test="ninWrapper != null">
#foreach($column in $tableInfo.fullColumn)
                <if test="ninWrapper.$!column.obj.name != null and ninWrapper.$!{column.obj.name}.size() > 0">
                    and `$!column.obj.name` not in
                    <foreach collection="ninWrapper.$!column.obj.name" item="$!column.obj.name" open="(" separator="," close=")">
                        #{$!column.obj.name}
                    </foreach>
                </if>
#end
            </if>
            <if test="keyWrapper != null and keyWrapper.size() > 0">
                <foreach collection="keyWrapper.entrySet()" index="k" item="columns">
                    <if test="columns != null and columns.size()> 0">
                        and
                        <foreach collection="columns" item="column" open="(" separator=" or " close=")">
                            `${column}` like CONCAT('%',#{k},'%')
                        </foreach>
                    </if>
                </foreach>
            </if>
        </where>
    </sql>
    
    <select id="countByCondition" resultType="int">
        select COUNT(*) from `$!{tableInfo.obj.name}`
        <include refid="where"/>
    </select>
    
    <select id="select" resultMap="baseMap">
        select * from `$!{tableInfo.obj.name}` where `id` = #{id}
    </select>
    
    <select id="selectByCondition" resultMap="baseMap">
        select * from `$!{tableInfo.obj.name}`
        <include refid="where"/>
        <if test="sortWrapper != null and sortWrapper.size() > 0">
            order by
            <foreach collection="sortWrapper.entrySet()" index="k" item="v" separator=",">
                `${k}` ${v}
            </foreach>
        </if>
        <if test="offset != null and limit != null">
            limit ${offset}, ${limit}
        </if>
    </select>

    <insert id="insert">
        insert into `$!{tableInfo.obj.name}`
        (<include refid="columns"/>)
        values
        (<include refid="columns_value"/>)
    </insert>

    <insert id="batchInsert" parameterType="list">
        insert into `$!{tableInfo.obj.name}`
        (<include refid="columns"/>)
        values
        <foreach collection="list" item="item" separator=",">
            (<include refid="columns_item_value"/>)
        </foreach>
    </insert>

    <delete id="delete" parameterType="string">
        delete from `$!{tableInfo.obj.name}` where `id` = #{id}
    </delete>

    <delete id="batchDelete" parameterType="list">
        delete from `$!{tableInfo.obj.name}` where `id` in
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <delete id="deleteByCondition">
        delete from `$!{tableInfo.obj.name}`
        <include refid="where"/>
    </delete>
    
    <update id="update" parameterType="$!{tableInfo.savePackageName}.model.entity.$!{tableInfo.name}">
        update `$!{tableInfo.obj.name}`
        <set>
#foreach($column in $tableInfo.otherColumn)
            <if test="$!column.name != null">
                `$!column.obj.name` = #{$!column.name},
            </if>
#end
        </set>
        where `id` = #{id}
    </update>

    <update id="batchUpdate" parameterType="list">
        <foreach collection="list" item="item" open="" close="" separator=";">
            update `$!{tableInfo.obj.name}`
            <set>
#foreach($column in $tableInfo.otherColumn)
                <if test="item.$!column.name != null">
                    `$!column.obj.name` = #{item.$!column.name},
                </if>
#end
            </set>
            where `id` = #{item.id}
        </foreach>
    </update>
    
    <update id="updateByCondition">
        update `$!{tableInfo.obj.name}`
        <set>
            <if test="upWrapper != null">
#foreach($column in $tableInfo.fullColumn)
                <if test="upWrapper.$!column.obj.name != null">
                    `$!column.obj.name` = #{upWrapper.$!column.obj.name},
                </if>
#end
            </if>
        </set>
        <include refid="where"/>
    </update>
</mapper>